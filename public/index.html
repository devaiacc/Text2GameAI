<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text to GameAI</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background: #000000;
            color: #ffffff;
            height: 100vh;
            display: flex;
            overflow-x: hidden;
            flex-direction: column;
        }

        .footer {
            background: #000000;
            padding: 1rem;
            border-top: 1px solid #ffffff;
            position: relative;
            z-index: 1000;
        }

        .input-container {
            display: flex;
            gap: 0.5rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .input-container input {
            flex: 1;
            padding: 0.75rem 1rem;
            background: #000000;
            border: 2px solid #ffffff;
            border-radius: 0;
            color: #ffffff;
            font-size: 16px;
            font-family: 'Courier New', monospace;
        }

        .input-container input:focus {
            outline: none;
            border-color: #ffffff;
        }

        .input-container input::placeholder {
            color: #888888;
        }

        .input-container button {
            padding: 0.75rem 2rem;
            background: #000000;
            border: 2px solid #ffffff;
            border-radius: 0;
            color: #ffffff;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Courier New', monospace;
            text-transform: uppercase;
        }

        .input-container button:hover:not(:disabled) {
            background: #ffffff;
            color: #000000;
        }

        .input-container button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            border-color: #444444;
            color: #444444;
        }

        .main-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 2px;
            background: #000000;
            overflow: hidden;
            border: 1px solid #ffffff;
            margin-right: 320px;
            margin-top: 50px;
            margin-bottom: 50px;
            max-width: calc(100vw - 320px);
        }

        .ai-log-section {
            width: 100%;
            height: 120px;
            background: #000000;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-bottom: 1px solid #00ff00;
        }

        .chat-section {
            position: fixed;
            top: 50px;
            right: 0;
            width: 320px;
            height: calc(100vh - 70px);
            background: #000000;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-left: 1px solid #ffffff;
            z-index: 100;
        }


        .model-section {
            flex: 1;
            background: #000000;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            width: 100%;
        }

        .ai-log-header {
            display: none;
        }

        .ai-log-countdown-bar {
            height: 30px;
            width: 100%;
            background: #111111;
            position: relative;
            overflow: hidden;
            display: none;
            border-bottom: 1px solid #00ff00;
        }

        .ai-log-countdown-bar.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-log-countdown-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(90deg, #00ff00 0%, #00aa00 100%);
            width: 0%;
            transition: width 1s linear;
        }

        .ai-log-countdown-text {
            position: relative;
            z-index: 10;
            color: #ffffff;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            padding: 0 1rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8), 0 0 8px rgba(0, 0, 0, 0.6);
        }

        .ai-log-content {
            flex: 1;
            padding: 0.5rem 1rem;
            background: #000000;
            color: #00ff00;
            font-family: 'Courier New', 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 16px;
            line-height: 1.5;
            overflow-y: auto;
            overflow-x: hidden;
            white-space: pre-wrap;
            word-wrap: break-word;
            border: none;
        }

        .ai-log-content .cursor {
            display: inline-block;
            width: 8px;
            height: 16px;
            background: #00ff00;
            margin-left: 2px;
            animation: blink 1s infinite;
        }

        .ai-log-content::-webkit-scrollbar-thumb {
            background: #00ff00;
        }

        .ai-log-content::-webkit-scrollbar-thumb:hover {
            background: #00cc00;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #000000;
        }

        ::-webkit-scrollbar-thumb {
            background: #ffffff;
            border: 1px solid #000000;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #cccccc;
        }

        .model-header {
            background: #000000;
            padding: 0.75rem 1rem;
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
            color: #ffffff;
            border-bottom: 2px solid #ffffff;
            font-family: 'Courier New', monospace;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .model-status {
            font-size: 14px;
            color: #ffffff;
        }

        .model-status.loading {
            color: #ffffff;
            animation: pulse 1.5s infinite;
        }

        .model-status.error {
            color: #ff0000;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .preview-section {
            flex: 1;
            background: #000000;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .preview-section .preview-header {
            flex-shrink: 0;
        }

        .preview-section .preview-iframe {
            flex: 1;
        }

        .project-description-header {
            background: #000000;
            padding: 0.75rem 1rem;
            font-size: 16px;
            color: #ffffff;
            border-bottom: 1px solid #ffffff;
            font-family: 'Courier New', monospace;
            line-height: 1.5;
            min-height: 50px;
            display: flex;
            align-items: center;
        }

        .chat-header {
            background: #000000;
            padding: 0.5rem 1rem;
            font-size: 15px;
            font-weight: bold;
            text-transform: uppercase;
            color: #ffffff;
            border-bottom: 1px solid #ffffff;
            font-family: 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .chat-header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-status {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .queue-badge {
            font-size: 13px;
            color: #ffffff;
            background: #222222;
            padding: 0.25rem 0.5rem;
            border: 1px solid #ffffff;
        }

        .countdown-badge {
            font-size: 13px;
            color: #ffffff;
            background: #222222;
            padding: 0.25rem 0.5rem;
            border: 1px solid #ffffff;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .chat-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .countdown-progress-bar {
            height: 15px;
            width: 100%;
            background: #222222;
            position: relative;
            overflow: hidden;
            display: none;
            margin-top: 0.5rem;
        }

        .countdown-progress-bar.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .countdown-progress-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(90deg, #ffffff 0%, #cccccc 100%);
            width: 100%;
            transition: width 1s linear;
        }

        .countdown-progress-text {
            position: relative;
            z-index: 10;
            color: #ffffff;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            font-weight: bold;
        }

        .chat-message {
            background: #000000;
            padding: 0.75rem;
            border: 1px solid #ffffff;
            border-radius: 0;
            font-size: 15px;
            line-height: 1.5;
            color: #ffffff;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
            margin-bottom: 0.5rem;
            transition: opacity 0.3s;
        }

        .chat-message.completed {
            opacity: 0.4;
        }

        .chat-message.processing {
            opacity: 1;
            border-color: #ffffff;
        }

        .chat-message.queued {
            opacity: 0.6;
        }

        .chat-message-info {
            font-size: 13px;
            color: #cccccc;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid #444444;
        }

        .chat-message-type {
            font-size: 11px;
            color: #00ff00;
            font-weight: bold;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .chat-message-link {
            color: #00ff00;
            text-decoration: none;
            font-weight: bold;
            margin-top: 0.5rem;
            display: inline-block;
            padding: 0.25rem 0;
            animation: blink 1.5s infinite;
        }

        .chat-message-link:hover {
            text-decoration: underline;
            color: #00cc00;
            animation: none;
        }

        .chat-message-countdown {
            color: #ffffff;
            font-weight: bold;
        }

        .chat-message.empty {
            color: #666666;
            font-style: italic;
            text-align: center;
            padding: 2rem;
            border: 1px dashed #666666;
        }

        .preview-header {
            background: #000000;
            padding: 0.5rem 1rem;
            font-size: 15px;
            font-weight: bold;
            text-transform: uppercase;
            color: #ffffff;
            border-bottom: 1px solid #ffffff;
            font-family: 'Courier New', monospace;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .preview-header-link {
            font-size: 12px;
            text-transform: none;
            color: #00ff00;
            text-decoration: none;
            font-weight: normal;
            margin-left: 1rem;
        }

        .preview-header-link:hover {
            text-decoration: underline;
        }

        .preview-header-link.blinking {
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.3;
            }
        }

        .preview-iframe {
            flex: 1;
            border: none;
            width: 100%;
            height: 100%;
            background: #000000;
        }

        .typing-indicator {
            position: fixed;
            bottom: 100px;
            right: 20px;
            background: #000000;
            color: #ffffff;
            padding: 0.5rem 1rem;
            border: 2px solid #ffffff;
            border-radius: 0;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            display: none;
            z-index: 1000;
            text-transform: uppercase;
        }

        .typing-indicator.active {
            display: block;
        }

        .marketcap-display {
            background: #000000;
            border-bottom: 1px solid #ffffff;
            padding: 0.75rem 1rem;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: bold;
            color: #ffffff;
            transition: background-color 0.5s ease;
            text-align: center;
        }


        .project-description {
            background: #000000;
            border-bottom: 1px solid #00ff00;
            padding: 0.75rem 1rem;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #00ff00;
            text-align: center;
            min-height: 50px;
            line-height: 1.5;
        }

        .active-prompt-display {
            background: #000000;
            border-bottom: 1px solid #00ff00;
            padding: 0.75rem 1rem;
            font-family: 'Courier New', monospace;
            font-size: 15px;
            color: #00ff00;
            line-height: 1.6;
        }

        .active-prompt-display .prompt-label {
            font-weight: bold;
            color: #00ff00;
            margin-bottom: 0.5rem;
            font-size: 16px;
        }

        .active-prompt-display .prompt-text {
            color: #00aa00;
            margin-bottom: 0.75rem;
            word-wrap: break-word;
            font-size: 15px;
        }

        .active-prompt-display .model-times {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            font-size: 14px;
        }

        .active-prompt-display .model-time {
            color: #00ff00;
        }

        .active-prompt-display .model-time.completed {
            color: #00aa00;
        }

        .active-prompt-display .model-time.processing {
            color: #00ff00;
        }

        .marketcap-display.price-up {
            background-color: rgba(0, 255, 0, 0.2);
            animation: priceUpBg 0.5s ease;
        }

        .marketcap-display.price-down {
            background-color: rgba(255, 0, 0, 0.2);
            animation: priceDownBg 0.5s ease;
        }

        @keyframes priceUpBg {
            0% { background-color: rgba(0, 255, 0, 0.4); }
            100% { background-color: rgba(0, 255, 0, 0.2); }
        }

        @keyframes priceDownBg {
            0% { background-color: rgba(255, 0, 0, 0.4); }
            100% { background-color: rgba(255, 0, 0, 0.2); }
        }

        @media (max-width: 1400px) {
            .main-container {
                margin-left: 0;
                margin-right: 0;
                max-width: 100vw;
            }

            .chat-section {
                position: relative;
                width: 100%;
                height: 250px;
                right: auto;
                top: auto;
            }
        }

        @media (max-width: 768px) {
            html, body {
                overflow-x: hidden;
                max-width: 100vw;
            }

            .main-container {
                margin-left: 0;
                margin-right: 0;
                margin-top: 60px;
                margin-bottom: 0;
                max-width: 100vw;
            }

            .live-trades-bar {
                height: 50px;
                font-size: 10px;
            }

            .logo-display {
                display: none;
            }

            .marketcap-display-top {
                font-size: 11px;
                padding: 0 8px;
            }

            .contract-display-top {
                font-size: 10px;
                padding: 0 6px;
            }

            .live-bar-title {
                font-size: 12px;
                padding: 0 0.5rem;
            }

            .live-trades-list li {
                font-size: 11px;
                padding: 0 6px;
            }

            .ai-log-section {
                height: 120px;
            }

            .ai-log-countdown-bar {
                height: 25px;
            }

            .ai-log-countdown-text {
                font-size: 11px;
                padding: 0 0.5rem;
            }

            .ai-log-content {
                font-size: 11px;
                padding: 0.5rem;
            }

            .project-description-header {
                font-size: 11px;
                padding: 0.5rem;
                min-height: 40px;
            }

            .model-header {
                font-size: 12px;
                padding: 0.5rem;
            }

            .model-status {
                font-size: 11px;
            }

            .chat-section {
                position: relative;
                width: 100%;
                height: 250px;
                right: auto;
                top: auto;
                border-left: none;
                border-top: 1px solid #ffffff;
            }

            .chat-header {
                font-size: 12px;
                padding: 0.4rem 0.5rem;
            }

            .queue-badge,
            .countdown-badge {
                font-size: 10px;
                padding: 0.15rem 0.3rem;
            }

            .chat-message {
                font-size: 12px;
                padding: 0.5rem;
            }

            .chat-message-info {
                font-size: 10px;
            }

            .footer {
                padding: 0.75rem;
            }

            .input-container {
                flex-direction: column;
                gap: 0.5rem;
            }

            .input-container input {
                font-size: 14px;
                padding: 0.5rem;
            }

            .input-container button {
                font-size: 14px;
                padding: 0.5rem 1rem;
            }

            .typing-indicator {
                font-size: 11px;
                padding: 0.3rem 0.5rem;
                bottom: 80px;
                right: 10px;
            }
        }

        @media (max-width: 480px) {
            html, body {
                overflow-x: hidden;
                max-width: 100vw;
            }

            .main-container {
                margin-left: 0;
                margin-right: 0;
                margin-top: 50px;
                margin-bottom: 0;
                max-width: 100vw;
            }

            .live-trades-bar {
                height: 45px;
                font-size: 9px;
            }

            .logo-display {
                display: none;
            }

            .marketcap-display-top {
                font-size: 10px;
                padding: 0 6px;
            }

            .contract-display-top {
                font-size: 9px;
                padding: 0 4px;
            }

            .live-bar-title {
                font-size: 11px;
                padding: 0 0.4rem;
            }

            .live-trades-list li {
                font-size: 10px;
                padding: 0 4px;
            }

            .ai-log-section {
                height: 100px;
            }

            .ai-log-countdown-bar {
                height: 22px;
            }

            .ai-log-countdown-text {
                font-size: 10px;
                padding: 0 0.4rem;
            }

            .ai-log-content {
                font-size: 10px;
                padding: 0.4rem;
            }

            .project-description-header {
                font-size: 10px;
                padding: 0.4rem;
                min-height: 35px;
            }

            .model-header {
                font-size: 11px;
                padding: 0.4rem;
            }

            .model-status {
                font-size: 10px;
            }

            .chat-section {
                position: relative;
                width: 100%;
                height: 200px;
                right: auto;
                top: auto;
                border-left: none;
                border-top: 1px solid #ffffff;
            }

            .chat-header {
                font-size: 11px;
                padding: 0.3rem 0.4rem;
            }

            .queue-badge,
            .countdown-badge {
                font-size: 9px;
                padding: 0.1rem 0.25rem;
            }

            .chat-message {
                font-size: 11px;
                padding: 0.4rem;
            }

            .chat-message-info {
                font-size: 9px;
            }

            .footer {
                padding: 0.5rem;
            }

            .input-container {
                flex-direction: column;
                gap: 0.5rem;
            }

            .input-container input {
                font-size: 13px;
                padding: 0.4rem;
                width: 100%;
            }

            .input-container button {
                font-size: 13px;
                padding: 0.4rem 0.8rem;
                width: 100%;
            }

            .typing-indicator {
                font-size: 10px;
                padding: 0.3rem 0.5rem;
                bottom: 70px;
                right: 5px;
            }
        }
        .live-trades-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 50px;
            background: #000000;
            border-bottom: 1px solid #ffffff;
            display: flex;
            flex-direction: row;
            align-items: center;
            z-index: 1000;
            overflow: hidden;
        }

        .logo-display {
            padding: 0 8px;
            font-family: 'Courier New', monospace;
            font-size: 3px;
            line-height: 0.9;
            color: #ffffff;
            white-space: pre;
            border-right: 1px solid #ffffff;
            height: 100%;
            display: flex;
            align-items: center;
            flex-shrink: 0;
            background-color: #000000;
            overflow: hidden;
        }

        .marketcap-display-top {
            padding: 0 15px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            font-weight: bold;
            color: #ffffff;
            white-space: nowrap;
            border-right: 1px solid #ffffff;
            height: 100%;
            display: flex;
            align-items: center;
            flex-shrink: 0;
            background-color: #000000;
            transition: background-color 0.5s ease;
        }

        .marketcap-display-top.price-up {
            background-color: rgba(0, 255, 0, 0.2);
            animation: priceUpBg 0.5s ease;
        }

        .marketcap-display-top.price-down {
            background-color: rgba(255, 0, 0, 0.2);
            animation: priceDownBg 0.5s ease;
        }

        .contract-display-top {
            padding: 0 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #ffffff;
            white-space: nowrap;
            border-right: 1px solid #ffffff;
            height: 100%;
            display: flex;
            align-items: center;
            flex-shrink: 0;
            background-color: #000000;
        }

        .contract-display-top a {
            color: #ffffff;
            text-decoration: none;
            cursor: pointer;
            transition: color 0.2s;
        }

        .contract-display-top a:hover {
            color: #cccccc;
        }

        .all-games-button {
            padding: 0 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: bold;
            color: #00ff00;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-right: 1px solid #ffffff;
            transition: background-color 0.2s, color 0.2s;
            height: 100%;
            flex-shrink: 0;
            white-space: nowrap;
            background-color: #000000;
        }

        .all-games-button:hover {
            background-color: rgba(0, 255, 0, 0.1);
            color: #00cc00;
        }

        .all-games-button:active {
            background-color: rgba(0, 255, 0, 0.2);
            color: #00aa00;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: #000000;
            border: 2px solid #ffffff;
            padding: 2rem;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #ffffff;
        }

        .modal-header h2 {
            color: #ffffff;
            font-size: 20px;
            font-weight: bold;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: 1px solid #ffffff;
            color: #ffffff;
            font-size: 18px;
            cursor: pointer;
            padding: 0.5rem 1rem;
            font-family: 'Courier New', monospace;
            transition: background-color 0.2s;
        }

        .modal-close:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .games-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .games-list li {
            padding: 0.75rem;
            border-bottom: 1px solid #333333;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
        }

        .games-list li:last-child {
            border-bottom: none;
        }

        .games-list a {
            color: #00ff00;
            text-decoration: none;
            font-size: 14px;
            flex: 1;
        }

        .games-list a:hover {
            text-decoration: underline;
            color: #00cc00;
        }

        .games-list .game-date {
            color: #cccccc;
            font-size: 12px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .games-list-empty {
            color: #666666;
            text-align: center;
            padding: 2rem;
            font-style: italic;
        }

        .live-trades-bar .live-bar-title {
            color: #ffffff;
            font-size: 18px;
            padding: 0 1rem;
            border-right: 1px solid #ffffff;
            font-weight: normal;
            flex-shrink: 0;
            white-space: nowrap;
            background-color: #000000;
            font-family: 'Courier New', monospace;
        }

        .live-trades-list {
            flex: 1;
            min-width: 0;
            overflow-x: auto;
            overflow-y: hidden;
            display: flex;
            flex-direction: row;
            list-style-type: none;
            margin: 0;
            padding: 0;
            gap: 0;
            align-items: center;
        }

        .live-trades-list::-webkit-scrollbar {
            height: 2px;
        }

        .live-trades-list::-webkit-scrollbar-track {
            background: #222222;
        }

        .live-trades-list::-webkit-scrollbar-thumb {
            background-color: #ffffff;
        }

        .live-trades-list li {
            display: inline-flex;
            align-items: center;
            padding: 0 10px;
            font-size: 18px;
            white-space: nowrap;
            border-right: 1px solid #ffffff;
            color: #ffffff;
            font-family: 'Courier New', monospace;
            opacity: 0;
            animation: slideInLeft 0.5s ease-out forwards;
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .live-trades-list li.buy {
            animation: slideInLeft 0.5s ease-out forwards, highlightBuy 0.5s ease-out;
        }

        .live-trades-list li.sell {
            animation: slideInLeft 0.5s ease-out forwards, highlightSell 0.5s ease-out;
        }

        @keyframes highlightBuy {
            0% {
                background-color: #00ff00;
            }
            100% {
                background-color: transparent;
            }
        }

        @keyframes highlightSell {
            0% {
                background-color: #ff0000;
            }
            100% {
                background-color: transparent;
            }
        }

        .live-trades-list li::before {
            content: '│';
            margin-right: 4px;
            color: #ffffff;
        }

        .live-trades-list li.buy {
            color: #00ff00;
        }

        .live-trades-list li.buy::before {
            content: '[+]';
            margin-right: 2px;
        }

        .live-trades-list li.sell {
            color: #ff0000;
        }

        .live-trades-list li.sell::before {
            content: '[-]';
            margin-right: 2px;
        }
    </style>
</head>
<body>
    <div class="live-trades-bar">
        <div class="logo-display" id="logoDisplay">░▒▓████████▓▒░▒▓███████▓▒░ ░▒▓██████▓▒░ ░▒▓██████▓▒░░▒▓█▓▒░ 

   ░▒▓█▓▒░          ░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░ 

   ░▒▓█▓▒░          ░▒▓█▓▒░▒▓█▓▒░      ░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░ 

   ░▒▓█▓▒░    ░▒▓██████▓▒░░▒▓█▓▒▒▓███▓▒░▒▓████████▓▒░▒▓█▓▒░ 

   ░▒▓█▓▒░   ░▒▓█▓▒░      ░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░ 

   ░▒▓█▓▒░   ░▒▓█▓▒░      ░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░ 

   ░▒▓█▓▒░   ░▒▓████████▓▒░░▒▓██████▓▒░░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░</div>
        <div class="marketcap-display-top" id="marketcapDisplayTop">
            <span id="marketcapValueTop">LOADING...</span>
        </div>
        <div class="all-games-button" id="allGamesButton">
            <span>ALL GAMES</span>
        </div>
        <div class="contract-display-top" id="contractDisplayTop">
            <a id="contractLinkTop" href="#" target="_blank"></a>
        </div>
        <div class="live-bar-title">LIVE TRADE</div>
        <ul class="live-trades-list" id="liveTradesList"></ul>
    </div>

    <div class="typing-indicator" id="typingIndicator">
        AI is generating code...
    </div>

    <div class="main-container">
        <div class="ai-log-section">
            <div class="ai-log-header">AI Log</div>
            <div class="ai-log-countdown-bar" id="aiLogCountdownBar">
                <div class="ai-log-countdown-fill" id="aiLogCountdownFill"></div>
                <div class="ai-log-countdown-text" id="aiLogCountdownText"></div>
            </div>
            <div class="ai-log-content" id="aiLogContent"></div>
        </div>

        <div class="model-section">
            <div class="model-header">
                <span>LLM PROCESSOR</span>
                <span class="model-status" id="llmStatus">Ready</span>
            </div>
            <div class="preview-section">
                <div class="preview-header" id="llmPreviewHeader" style="display: none;">
                    <span>PREVIEW</span>
                    <a href="#" id="llmPreviewLink" class="preview-header-link" target="_blank" style="display: none;">Open in new tab →</a>
                </div>
                <iframe class="preview-iframe" id="llmPreview" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
            </div>
        </div>

        <div class="chat-section">
            <div class="project-description-header" id="projectDescriptionHeader"></div>
            <div class="chat-header">
                <div class="chat-header-top">
                    <span>Chat History</span>
                    <div class="header-status">
                        <span class="countdown-badge" id="countdownBadge" style="display: none;">Next in <span id="countdownSeconds">0</span>s</span>
                        <span class="queue-badge" id="queueBadge" style="display: none;">Queue: <span id="queueCount">0</span></span>
                    </div>
                </div>
                <div class="countdown-progress-bar" id="countdownProgressBar">
                    <div class="countdown-progress-fill" id="countdownProgressFill"></div>
                    <span class="countdown-progress-text" id="countdownProgressText"></span>
                </div>
            </div>
            <div class="chat-content" id="chatContent">
                <div class="chat-message empty">No prompts yet</div>
            </div>
        </div>
    </div>

    <div class="footer" id="footerSection" style="display: none;">
        <div class="input-container">
            <input type="text" id="promptInput" placeholder="Enter your prompt (e.g., '!create call of duty, !pc mario, !mobile flappy bird')" />
            <button id="generateBtn">Generate</button>
        </div>
    </div>

    <div class="modal-overlay" id="allGamesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ALL GAMES</h2>
                <button class="modal-close" id="modalClose">✕ Close</button>
            </div>
            <ul class="games-list" id="gamesList">
                <li class="games-list-empty">Loading games...</li>
            </ul>
        </div>
    </div>

    <script>
        const socket = io();
        const promptInput = document.getElementById('promptInput');
        const generateBtn = document.getElementById('generateBtn');
        const typingIndicator = document.getElementById('typingIndicator');
        const chatContent = document.getElementById('chatContent');
        const aiLogContent = document.getElementById('aiLogContent');
        const footerSection = document.getElementById('footerSection');
        
        let testInputMode = true;
        
        const activePromptDisplay = document.getElementById('activePromptDisplay');
        const activePromptText = document.getElementById('activePromptText');
        const modelTimes = document.getElementById('modelTimes');
        
        let modelTimings = {
            'Gemini': null
        };
        
        let modelCompletionOrder = [];
        
        function updateActivePromptDisplay(prompt) {
            if (!activePromptText || !activePromptDisplay) return;
            activePromptText.textContent = prompt;
            activePromptDisplay.style.display = 'block';
            
            modelTimings = {
                'LLM': null
            };
            modelCompletionOrder = [];
            updateModelTimesDisplay();
        }

        function updateModelTimesDisplay() {
            if (!modelTimes) return;
            modelTimes.innerHTML = '';
            
            const completedModels = [];
            const processingModels = [];
            
            Object.keys(modelTimings).forEach(modelName => {
                if (modelTimings[modelName] !== null) {
                    completedModels.push({
                        name: modelName,
                        duration: modelTimings[modelName]
                    });
                } else {
                    processingModels.push(modelName);
                }
            });
            
            completedModels.sort((a, b) => {
                if (a.duration === 'N/A') return 1;
                if (b.duration === 'N/A') return -1;
                return a.duration - b.duration;
            });
            
            if (!modelTimes) return;
            
            completedModels.forEach((model, index) => {
                const timeDiv = document.createElement('div');
                timeDiv.className = 'model-time completed';
                timeDiv.textContent = `${index + 1}. [${model.name}] Completed in ${model.duration}s`;
                modelTimes.appendChild(timeDiv);
            });
            
            processingModels.forEach(modelName => {
                const timeDiv = document.createElement('div');
                timeDiv.className = 'model-time processing';
                timeDiv.textContent = `[${modelName}] Processing...`;
                modelTimes.appendChild(timeDiv);
            });
        }
        
        const emptyPreviewHTML = '<!DOCTYPE html><html><head><style>body{margin:0;padding:0;background:#000;color:#00ff00;font-family:"Courier New",monospace;display:flex;align-items:center;justify-content:center;height:100vh;font-size:14px;}</style></head><body><div>Waiting for content...</div></body></html>';
        
        const llmPreview = document.getElementById('llmPreview');
        const llmStatus = document.getElementById('llmStatus');
        const marketcapDisplayTop = document.getElementById('marketcapDisplayTop');
        const marketcapValueTop = document.getElementById('marketcapValueTop');
        const contractLinkTop = document.getElementById('contractLinkTop');
        const projectDescriptionHeader = document.getElementById('projectDescriptionHeader');
        
        if (llmPreview) {
            llmPreview.srcdoc = emptyPreviewHTML;
        }

        let currentTypewriter = null;
        let completedModels = new Set();
        let currentRequestId = null;
        let requestMessages = new Map();
        let queueLength = 0;
        let countdownIntervals = new Map();
        let lastMarketCap = 0;
        
        const modelData = {
            'LLM': { preview: llmPreview, status: llmStatus }
        };

        function typewriterText(element, text, maxDuration = 2000) {
            if (!element) return;
            element.innerHTML = '';
            const textLength = text.length;
            const delay = textLength > 0 ? Math.max(1, Math.floor(maxDuration / textLength)) : 1;
            let index = 0;

            function type() {
                if (!element) return;
                if (index < textLength) {
                    element.textContent = text.substring(0, index + 1);
                    index++;
                    setTimeout(type, delay);
                } else {
                    element.textContent = text;
                }
            }

            type();
        }

        function appendToLog(text, append = false, useTypewriter = false) {
            if (currentTypewriter) {
                clearTimeout(currentTypewriter);
            }

            const cleanedText = text.replace(/&/g, '').replace(/\n\s*\n+/g, '\n');
            const trimmedText = cleanedText.trim();
            const escapedText = trimmedText.replace(/</g, '&lt;').replace(/>/g, '&gt;');
            const formattedText = escapedText.replace(/\n/g, '<br>').replace(/\s+/g, ' ').trim();
            const cursor = '<span class="cursor"></span>';

            if (append) {
                const currentHTML = aiLogContent.innerHTML.replace(/<span class="cursor"><\/span>$/, '').trim();
                const trimmedFormatted = formattedText.trim();
                const fullText = trimmedFormatted + (trimmedFormatted && currentHTML ? '<br>' : '') + currentHTML;
                
                if (!useTypewriter) {
                    aiLogContent.innerHTML = fullText + cursor;
                    aiLogContent.scrollTop = 0;
                    return;
                }

                const newTextLength = trimmedFormatted.length;
                const maxDuration = 200;
                const delay = newTextLength > 0 ? Math.max(1, Math.floor(maxDuration / newTextLength)) : 1;
                let index = 0;

                function type() {
                    if (index < trimmedFormatted.length) {
                        const displayText = trimmedFormatted.substring(0, index + 1) + (trimmedFormatted && currentHTML ? '<br>' : '') + currentHTML;
                        aiLogContent.innerHTML = displayText + cursor;
                        index++;
                        currentTypewriter = setTimeout(type, delay);
                    } else {
                        const finalText = trimmedFormatted + (trimmedFormatted && currentHTML ? '<br>' : '') + currentHTML;
                        aiLogContent.innerHTML = finalText + cursor;
                        currentTypewriter = null;
                    }
                    aiLogContent.scrollTop = 0;
                }

                type();
            } else {
                const fullText = formattedText.trim();
                
                if (!useTypewriter) {
                    const existingContent = aiLogContent.innerHTML.replace(/<span class="cursor"><\/span>$/, '').trim();
                    aiLogContent.innerHTML = fullText + (fullText && existingContent ? '<br><br>' : '') + existingContent + cursor;
                    aiLogContent.scrollTop = 0;
                    return;
                }

                const newTextLength = fullText.length;
                const maxDuration = 200;
                const delay = newTextLength > 0 ? Math.max(1, Math.floor(maxDuration / newTextLength)) : 1;
                let index = 0;
                const existingContent = aiLogContent.innerHTML.replace(/<span class="cursor"><\/span>$/, '').trim();

                function type() {
                    if (index < fullText.length) {
                        const displayText = fullText.substring(0, index + 1) + (fullText && existingContent ? '<br><br>' : '') + existingContent;
                        aiLogContent.innerHTML = displayText + cursor;
                        index++;
                        currentTypewriter = setTimeout(type, delay);
                    } else {
                        const finalText = fullText + (fullText && existingContent ? '<br><br>' : '') + existingContent;
                        aiLogContent.innerHTML = finalText + cursor;
                        currentTypewriter = null;
                    }
                    aiLogContent.scrollTop = 0;
                }

                type();
            }
        }

        function updatePreview(html, css, js, previewFrame) {
            if (!html.trim()) {
                previewFrame.srcdoc = emptyPreviewHTML;
                return;
            }

            let fullHTML = html;
            const styleContent = css.trim();
            const scriptContent = js.trim();
            
            if (styleContent) {
                const styleTag = '<style>' + styleContent + '<\/style>';
                const headEndIndex = fullHTML.indexOf('<\/head>');
                if (headEndIndex !== -1) {
                    fullHTML = fullHTML.substring(0, headEndIndex) + styleTag + fullHTML.substring(headEndIndex);
                } else {
                    const headIndex = fullHTML.indexOf('<head>');
                    if (headIndex !== -1) {
                        fullHTML = fullHTML.substring(0, headIndex + 6) + styleTag + fullHTML.substring(headIndex + 6);
                    } else {
                        const htmlIndex = fullHTML.indexOf('<html');
                        if (htmlIndex !== -1) {
                            const htmlEndIndex = fullHTML.indexOf('>', htmlIndex);
                            fullHTML = fullHTML.substring(0, htmlEndIndex + 1) + '<head>' + styleTag + '<\/head>' + fullHTML.substring(htmlEndIndex + 1);
                        } else {
                            fullHTML = '<!DOCTYPE html><html><head>' + styleTag + '<\/head><body>' + fullHTML + '<\/body><\/html>';
                        }
                    }
                }
            }

            if (scriptContent) {
                const scriptTag = '<script>' + scriptContent + '<\/script>';
                const bodyEndIndex = fullHTML.indexOf('<\/body>');
                if (bodyEndIndex !== -1) {
                    fullHTML = fullHTML.substring(0, bodyEndIndex) + scriptTag + fullHTML.substring(bodyEndIndex);
                } else {
                    const bodyIndex = fullHTML.indexOf('<body');
                    if (bodyIndex !== -1) {
                        const bodyEndTagIndex = fullHTML.indexOf('>', bodyIndex);
                        fullHTML = fullHTML.substring(0, bodyEndTagIndex + 1) + scriptTag + fullHTML.substring(bodyEndTagIndex + 1);
                    } else {
                        const htmlEndIndex = fullHTML.indexOf('<\/html>');
                        if (htmlEndIndex !== -1) {
                            fullHTML = fullHTML.substring(0, htmlEndIndex) + '<body>' + scriptTag + '<\/body>' + fullHTML.substring(htmlEndIndex);
                        } else {
                            fullHTML += scriptTag;
                        }
                    }
                }
            }

            previewFrame.srcdoc = fullHTML;
        }

        function addChatMessage(prompt, requestId, status = 'processing', queuePosition = null, duration = null, commandType = 'create') {
            const emptyMsg = chatContent.querySelector('.chat-message.empty');
            if (emptyMsg) {
                emptyMsg.remove();
            }

            let messageDiv = requestMessages.get(requestId);
            
            // Get game type label
            let gameTypeLabel = '';
            if (commandType === 'pc') {
                gameTypeLabel = 'Desktop Game';
            } else if (commandType === 'mobile') {
                gameTypeLabel = 'Mobile Game';
            } else {
                gameTypeLabel = 'Autoplay Game';
            }
            
            if (!messageDiv) {
                messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message';
                messageDiv.setAttribute('data-request-id', requestId);
                messageDiv.innerHTML = `<div class="chat-message-type">${gameTypeLabel}</div><div class="chat-message-text">${prompt}</div><div class="chat-message-info"></div>`;
                chatContent.insertBefore(messageDiv, chatContent.firstChild);
                requestMessages.set(requestId, messageDiv);
            } else {
                // Update game type if it exists
                let typeDiv = messageDiv.querySelector('.chat-message-type');
                if (!typeDiv) {
                    typeDiv = document.createElement('div');
                    typeDiv.className = 'chat-message-type';
                    const textDiv = messageDiv.querySelector('.chat-message-text');
                    if (textDiv) {
                        messageDiv.insertBefore(typeDiv, textDiv);
                    } else {
                        messageDiv.insertBefore(typeDiv, messageDiv.firstChild);
                    }
                }
                typeDiv.textContent = gameTypeLabel;
            }
            
            const textDiv = messageDiv.querySelector('.chat-message-text');
            const infoDiv = messageDiv.querySelector('.chat-message-info');
            
            if (textDiv) {
                textDiv.textContent = prompt;
            }
            messageDiv.className = 'chat-message ' + status;
            
            let infoText = '';
            if (status === 'queued' && queuePosition !== null) {
                infoText = `Queue position: ${queuePosition}`;
            } else if (status === 'processing') {
                infoText = 'Processing...';
            } else if (status === 'completed' && duration !== null) {
                infoText = `Completed in ${duration}s`;
            }
            
            if (infoDiv) {
                infoDiv.textContent = infoText;
            }
            chatContent.scrollTop = 0;
        }

        socket.on('generated_file_url', (data) => {
            // Update preview header link
            if (data.requestId === currentRequestId && llmPreviewLink && llmPreviewHeader) {
                llmPreviewLink.href = data.url;
                llmPreviewLink.style.display = 'inline';
                llmPreviewHeader.style.display = 'flex';
                // Add blinking animation
                llmPreviewLink.classList.add('blinking');
            }
            
            // Update chat message link - add directly inside chat-message div
            const messageDiv = requestMessages.get(data.requestId);
            if (messageDiv) {
                let linkDiv = messageDiv.querySelector('.chat-message-link');
                if (!linkDiv) {
                    linkDiv = document.createElement('a');
                    linkDiv.className = 'chat-message-link';
                    linkDiv.target = '_blank';
                    linkDiv.rel = 'noopener noreferrer';
                    
                    // Add link directly to chat-message div, after chat-message-text
                    const textDiv = messageDiv.querySelector('.chat-message-text');
                    if (textDiv) {
                        // Add line break and link after text
                        textDiv.appendChild(document.createElement('br'));
                        textDiv.appendChild(linkDiv);
                    } else {
                        // Fallback: add to messageDiv directly
                        messageDiv.appendChild(linkDiv);
                    }
                }
                linkDiv.href = data.url;
                linkDiv.textContent = 'Open in new tab →';
                linkDiv.style.display = 'inline-block';
            }
        });

        let myRequestIds = new Set();

        function generateCode() {
            if (!testInputMode) {
                return;
            }
            const prompt = promptInput.value.trim();
            if (!prompt) {
                alert('Please enter a prompt');
                return;
            }

            appendToLog('────────────────────────────────────────\n', false, false);
            completedModels.clear();
            
            promptInput.value = '';
            socket.emit('generate_code', { prompt });
        }
        
        function checkAllCompleted() {
            if (completedModels.size === 1 && currentRequestId) {
                generateBtn.disabled = false;
            }
        }

        generateBtn.addEventListener('click', generateCode);
        promptInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                generateCode();
            }
        });

        socket.on('model_start', (data) => {
            const model = modelData[data.model];
            if (model) {
                model.status.textContent = 'Loading...';
                model.status.classList.add('loading');
            }
        });

        const aiLogCountdownBar = document.getElementById('aiLogCountdownBar');
        const aiLogCountdownFill = document.getElementById('aiLogCountdownFill');
        const aiLogCountdownText = document.getElementById('aiLogCountdownText');

        socket.on('ai_log_countdown_start', (data) => {
            if (data.requestId === currentRequestId) {
                aiLogCountdownBar.classList.add('active');
                aiLogCountdownFill.style.width = '100%';
                const promptText = data.prompt.length > 50 ? data.prompt.substring(0, 50) + '...' : data.prompt;
                aiLogCountdownText.textContent = `${promptText} | 60s`;
            }
        });

        socket.on('ai_log_countdown_update', (data) => {
            if (data.requestId === currentRequestId) {
                const progressPercent = (data.seconds / 60) * 100;
                aiLogCountdownFill.style.width = `${progressPercent}%`;
                const promptText = data.prompt.length > 50 ? data.prompt.substring(0, 50) + '...' : data.prompt;
                aiLogCountdownText.textContent = `${promptText} | ${data.seconds}s`;
            }
        });

        socket.on('request_started', (data) => {
            const isMyRequest = myRequestIds.has(data.requestId);
            
            if (isMyRequest) {
                currentRequestId = data.requestId;
                completedModels.clear();
                Object.values(modelData).forEach(model => {
                    model.preview.srcdoc = emptyPreviewHTML;
                    model.status.textContent = 'Loading...';
                    model.status.classList.add('loading');
                });
            } else {
                currentRequestId = data.requestId;
            }
            
            updateActivePromptDisplay(data.prompt);
            addChatMessage(data.prompt, data.requestId, 'processing', null, null, data.commandType || 'create');
        });

        socket.on('request_queued', (data) => {
            addChatMessage(data.prompt, data.requestId, 'queued', data.queuePosition, null, data.commandType || 'create');
        });

        socket.on('queue_update', (data) => {
            queueLength = data.queueLength;
            const queueBadge = document.getElementById('queueBadge');
            const queueCount = document.getElementById('queueCount');
            
            if (queueLength > 0) {
                queueBadge.style.display = 'block';
                queueCount.textContent = queueLength;
            } else {
                queueBadge.style.display = 'none';
            }
        });

        socket.on('request_completed', (data) => {
            const messageDiv = requestMessages.get(data.requestId);
            if (messageDiv) {
                messageDiv.className = 'chat-message completed';
                const infoDiv = messageDiv.querySelector('.chat-message-info');
                infoDiv.textContent = `Completed in ${data.duration}s`;
            }
            
            if (data.requestId === currentRequestId) {
                aiLogCountdownBar.classList.remove('active');
                aiLogCountdownFill.style.width = '0%';
                aiLogCountdownText.textContent = '';
            }
            
            setTimeout(() => {
                if (data.requestId === currentRequestId && activePromptDisplay) {
                    activePromptDisplay.style.display = 'none';
                }
            }, 10000);
        });

        socket.on('countdown_update', (data) => {
            const countdownBadge = document.getElementById('countdownBadge');
            const countdownSeconds = document.getElementById('countdownSeconds');
            const countdownProgressBar = document.getElementById('countdownProgressBar');
            const countdownProgressFill = document.getElementById('countdownProgressFill');
            const countdownProgressText = document.getElementById('countdownProgressText');
            
            if (data.requestId && data.seconds !== null && data.seconds !== undefined) {
                countdownBadge.style.display = 'block';
                countdownSeconds.textContent = data.seconds;
                
                countdownProgressBar.classList.add('active');
                const progressPercent = (data.seconds / 10) * 100;
                countdownProgressFill.style.width = `${progressPercent}%`;
                countdownProgressText.textContent = `${data.seconds}s`;
            } else {
                countdownBadge.style.display = 'none';
                countdownProgressBar.classList.remove('active');
                countdownProgressFill.style.width = '100%';
                countdownProgressText.textContent = '';
            }
            
            const messageDiv = requestMessages.get(data.requestId);
            if (messageDiv && data.seconds !== null) {
                const infoDiv = messageDiv.querySelector('.chat-message-info');
                infoDiv.innerHTML = `Completed. Next in <span class="chat-message-countdown">${data.seconds}s</span>`;
            }
        });

        socket.on('model_response', (data) => {
            const model = modelData[data.model];
            if (model) {
                if (data.requestId === currentRequestId) {
                    model.status.textContent = `Done (${data.duration}s)`;
                    model.status.classList.remove('loading');
                    updatePreview(data.html, data.css, data.js, model.preview);
                    completedModels.add(data.model);
                    checkAllCompleted();
                    
                    modelTimings[data.model] = data.duration;
                    updateModelTimesDisplay();
                } else {
                    updatePreview(data.html, data.css, data.js, model.preview);
                }
            }
        });

        socket.on('model_error', (data) => {
            const model = modelData[data.model];
            if (model && data.requestId === currentRequestId) {
                model.status.textContent = 'Error';
                model.status.classList.remove('loading');
                model.status.classList.add('error');
                model.preview.srcdoc = emptyPreviewHTML;
                completedModels.add(data.model);
                checkAllCompleted();
                
                if (data.duration) {
                    modelTimings[data.model] = data.duration;
                } else {
                    modelTimings[data.model] = 'N/A';
                }
                updateModelTimesDisplay();
            }
        });

        socket.on('model_start', (data) => {
            const model = modelData[data.model];
            if (model && data.requestId === currentRequestId) {
                model.status.textContent = 'Loading...';
                model.status.classList.add('loading');
            }
        });

        socket.on('ai_log', (data) => {
            if (data.text) {
                const cleanedText = data.text.replace(/&/g, '').replace(/\n\s*\n/g, '\n');
                appendToLog(cleanedText, data.append || false, true);
            }
        });

        socket.on('ai_error', (data) => {
            alert(data.message || 'An error occurred');
            generateBtn.disabled = false;
            typingIndicator.classList.remove('active');
        });

        socket.on('prompt_history', (data) => {
            if (data.history && data.history.length > 0) {
                const emptyMsg = chatContent.querySelector('.chat-message.empty');
                if (emptyMsg) {
                    emptyMsg.remove();
                }
                data.history.forEach((prompt, index) => {
                    const requestId = `history-${Date.now()}-${index}`;
                    addChatMessage(prompt, requestId, 'completed');
                });
            }
        });

        socket.on('prompt_added', (data) => {
            if (data.requestId && data.status) {
                addChatMessage(data.prompt, data.requestId, data.status, null, null, data.commandType || 'create');
            }
        });

        socket.on('test_input_mode', (data) => {
            testInputMode = data.enabled;
            if (testInputMode) {
                footerSection.style.display = 'block';
            } else {
                footerSection.style.display = 'none';
            }
        });

        socket.on('contract_address', (data) => {
            if (data.address) {
                const contractAddress = data.address;
                contractLinkTop.textContent = contractAddress;
                contractLinkTop.href = `https://pump.fun/coin/${contractAddress}`;
            }
        });

        socket.on('project_description', (data) => {
            if (data.description && projectDescriptionHeader) {
                typewriterText(projectDescriptionHeader, data.description, 3000);
            }
        });

        socket.on('marketCapUpdate', (data) => {
            if (data && data.marketCap) {
                const newMarketCap = data.marketCap;
                const formattedMC = `$${Math.floor(newMarketCap).toLocaleString()}`;
                marketcapValueTop.textContent = formattedMC;

                marketcapDisplayTop.classList.remove('price-up', 'price-down');
                
                if (lastMarketCap !== 0) {
                    if (newMarketCap > lastMarketCap) {
                        marketcapDisplayTop.classList.add('price-up');
                    } else if (newMarketCap < lastMarketCap) {
                        marketcapDisplayTop.classList.add('price-down');
                    }
                }
                lastMarketCap = newMarketCap;

                setTimeout(() => {
                    marketcapDisplayTop.classList.remove('price-up', 'price-down');
                }, 500);
            }
        });

        socket.on('newTrade', (trade) => {
            const liveTradesList = document.getElementById('liveTradesList');
            const usdValue = trade.usdValue ? Number(trade.usdValue).toFixed(2) : 'N/A';
            
            const liveItem = document.createElement('li');
            liveItem.textContent = `$${usdValue}`;
            liveItem.classList.add(trade.isBuy ? 'buy' : 'sell');
            liveTradesList.insertBefore(liveItem, liveTradesList.firstChild);
            if (liveTradesList.children.length > 100) {
                liveTradesList.removeChild(liveTradesList.lastChild);
            }
            liveTradesList.scrollLeft = 0;
        });

        // All Games Modal functionality
        function loadGamesList() {
            const gamesList = document.getElementById('gamesList');
            if (!gamesList) return;
            
            gamesList.innerHTML = '<li class="games-list-empty">Loading games...</li>';
            
            fetch('/api/games')
                .then(response => response.json())
                .then(data => {
                    if (data.games && data.games.length > 0) {
                        gamesList.innerHTML = '';
                        data.games.forEach(game => {
                            const li = document.createElement('li');
                            
                            // Calculate time ago
                            const now = Date.now();
                            const gameTime = game.date;
                            const secondsAgo = Math.floor((now - gameTime) / 1000);
                            
                            let timeAgoText = '';
                            if (secondsAgo < 60) {
                                timeAgoText = `${secondsAgo}s ago`;
                            } else if (secondsAgo < 3600) {
                                const minutesAgo = Math.floor(secondsAgo / 60);
                                timeAgoText = `${minutesAgo}m ago`;
                            } else if (secondsAgo < 86400) {
                                const hoursAgo = Math.floor(secondsAgo / 3600);
                                timeAgoText = `${hoursAgo}h ago`;
                            } else {
                                const daysAgo = Math.floor(secondsAgo / 86400);
                                timeAgoText = `${daysAgo}d ago`;
                            }
                            
                            // Get game type label
                            let gameTypeLabel = '';
                            if (game.commandType === 'pc') {
                                gameTypeLabel = 'Desktop';
                            } else if (game.commandType === 'mobile') {
                                gameTypeLabel = 'Mobile';
                            } else {
                                gameTypeLabel = 'Autoplay (Stream)';
                            }
                            
                            // Create container for prompt and link
                            const contentDiv = document.createElement('div');
                            contentDiv.style.display = 'flex';
                            contentDiv.style.flexDirection = 'column';
                            contentDiv.style.gap = '0.25rem';
                            
                            // Game type badge
                            const typeBadge = document.createElement('div');
                            typeBadge.style.color = '#00ff00';
                            typeBadge.style.fontSize = '11px';
                            typeBadge.style.fontWeight = 'bold';
                            typeBadge.style.textTransform = 'uppercase';
                            typeBadge.style.letterSpacing = '0.5px';
                            typeBadge.textContent = gameTypeLabel;
                            
                            // Prompt text
                            const promptDiv = document.createElement('div');
                            promptDiv.style.color = '#ffffff';
                            promptDiv.style.fontSize = '13px';
                            promptDiv.textContent = game.prompt || 'Unknown prompt';
                            
                            // Link
                            const link = document.createElement('a');
                            link.href = game.url;
                            link.target = '_blank';
                            link.textContent = 'Open game →';
                            link.style.color = '#00ff00';
                            link.style.textDecoration = 'none';
                            link.style.fontSize = '12px';
                            
                            // Time ago
                            const dateSpan = document.createElement('span');
                            dateSpan.className = 'game-date';
                            dateSpan.textContent = timeAgoText;
                            
                            contentDiv.appendChild(typeBadge);
                            contentDiv.appendChild(promptDiv);
                            contentDiv.appendChild(link);
                            
                            li.appendChild(contentDiv);
                            li.appendChild(dateSpan);
                            gamesList.appendChild(li);
                        });
                    } else {
                        gamesList.innerHTML = '<li class="games-list-empty">0 games found. No games created yet.</li>';
                    }
                })
                .catch(error => {
                    console.error('Error loading games:', error);
                    gamesList.innerHTML = '<li class="games-list-empty">Error loading games. Please try again.</li>';
                });
        }

        const allGamesButton = document.getElementById('allGamesButton');
        const allGamesModal = document.getElementById('allGamesModal');
        const modalClose = document.getElementById('modalClose');

        if (allGamesButton && allGamesModal) {
            allGamesButton.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                allGamesModal.classList.add('active');
                loadGamesList();
            });
        } else {
            console.error('All Games button or modal not found', { allGamesButton, allGamesModal });
        }

        if (modalClose) {
            modalClose.addEventListener('click', () => {
                if (allGamesModal) {
                    allGamesModal.classList.remove('active');
                }
            });
        }

        if (allGamesModal) {
            allGamesModal.addEventListener('click', (e) => {
                if (e.target === allGamesModal) {
                    allGamesModal.classList.remove('active');
                }
            });
        }

        if (window.innerWidth <= 768) {
            const mobileAlertShown = localStorage.getItem('mobileAlertShown');
            if (!mobileAlertShown) {
                alert('For optimal viewing and experience, please visit from desktop or watch from pumpfun stream.');
                localStorage.setItem('mobileAlertShown', 'true');
            }
        }
    </script>
</body>
</html>
